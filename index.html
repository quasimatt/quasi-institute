<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="Quasi_Institute_Logo.svg" type="image/svg+xml">
  <title>QUASI INSTITUTE</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      width: 100%;
      background: black;
    }
    img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: fill;
    }

    #desktopOverlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      pointer-events: none;
    }

    .desktop-icon {
      position: absolute;
      width: 84px;
      pointer-events: auto;
      user-select: none;
      touch-action: none;
      filter: drop-shadow(0 4px 16px rgba(0,0,0,.35));
      cursor: pointer;
      transition: transform 0.1s ease;
    }
    .desktop-icon:active { transform: scale(0.96); }

    .desktop-icon .thumb {
      width: 84px; height: 84px;
      border-radius: 14px;
      background: transparent;
      border: 1px solid rgba(255,255,255,.35);
      display: grid; place-items: center;
    }
    .desktop-icon .thumb .pdf {
      font-size: 44px; line-height: 1;
    }

    .desktop-icon .label {
      margin-top: 6px;
      width: 100%;
      text-align: center;
      font: 12px/1.25 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,.9);
    }
  </style>
</head>
<body>
  <div style="text-align:center;">
    <a href="https://forms.gle/D2s1P6wj58EfSYsf8" target="_blank" rel="noopener"
       style="font-family:'Computer Modern','CMU Serif','Latin Modern Roman',Georgia,'Times New Roman',Times,serif;color:#fff;">
      Sign up for updates.
    </a>
  </div>

  <img src="Quasi_Institute_Logo.svg" alt="Quasi Institute Logo">

  <div id="desktopOverlay" aria-label="Desktop overlay for PDFs"></div>

  <script>
  (function(){
    const icons = [
      { id: 'gender', title: 'Gender as a Topological Space', href: '/pdfs/Gender_QuasiInstitute.pdf', x: 40, y: 120 },
    ];

    const overlay = document.getElementById('desktopOverlay');
    const saved = JSON.parse(localStorage.getItem('desktopIconPositions') || '{}');

    icons.forEach(meta => {
      const el = document.createElement('div');
      el.className = 'desktop-icon';
      el.id = 'icon-' + meta.id;
      el.dataset.href = meta.href;
      el.dataset.id = meta.id;

      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      thumb.innerHTML = '<div class="pdf">ðŸ“„</div>';

      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = meta.title;

      el.appendChild(thumb);
      el.appendChild(label);
      overlay.appendChild(el);

      const pos = saved[meta.id] || { x: meta.x, y: meta.y };
      position(el, pos.x, pos.y);

      makeDraggableAndClickable(el);
    });

    function position(el, x, y) {
      const w = 84, h = 100;
      const pad = 8;
      const maxX = innerWidth  - w - pad;
      const maxY = innerHeight - h - pad;
      const nx = Math.max(pad, Math.min(x, maxX));
      const ny = Math.max(pad, Math.min(y, maxY));
      el.style.transform = `translate(${nx}px, ${ny}px)`;
      el.dataset.x = nx; el.dataset.y = ny;
    }

    function persist(el) {
      const id = el.dataset.id;
      const store = JSON.parse(localStorage.getItem('desktopIconPositions') || '{}');
      store[id] = { x: parseFloat(el.dataset.x), y: parseFloat(el.dataset.y) };
      localStorage.setItem('desktopIconPositions', JSON.stringify(store));
    }

    function makeDraggableAndClickable(el) {
      let startX=0, startY=0, origX=0, origY=0, dragging=false, moved=false;
      const overlay = document.getElementById('desktopOverlay');

      el.addEventListener('pointerdown', (e) => {
        if (e.button !== undefined && e.button !== 0) return;
        dragging = true; moved = false;
        el.setPointerCapture(e.pointerId);
        const rect = overlay.getBoundingClientRect();
        origX = parseFloat(el.dataset.x || 0);
        origY = parseFloat(el.dataset.y || 0);
        startX = e.clientX - rect.left;
        startY = e.clientY - rect.top;
      });

      el.addEventListener('pointermove', (e) => {
        if (!dragging) return;
        const rect = overlay.getBoundingClientRect();
        const cx = e.clientX - rect.left;
        const cy = e.clientY - rect.top;
        const dx = cx - startX, dy = cy - startY;
        if (Math.abs(dx) > 3 || Math.abs(dy) > 3) moved = true; // threshold
        position(el, origX + dx, origY + dy);
      });

      el.addEventListener('pointerup', (e) => {
        if (!dragging) return;
        dragging = false;
        el.releasePointerCapture(e.pointerId);
        persist(el);
        // only open if not moved
        if (!moved) {
          const href = el.dataset.href;
          if (href) window.open(href, '_blank', 'noopener');
        }
      });

      el.addEventListener('dragstart', (e) => e.preventDefault());
    }

    window.addEventListener('resize', () => {
      overlay.querySelectorAll('.desktop-icon').forEach(el => {
        position(el, parseFloat(el.dataset.x||0), parseFloat(el.dataset.y||0));
      });
    });
  })();
  </script>
</body>
</html>

